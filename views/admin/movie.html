<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/admin.movie.css">
    <title>Admin Panel</title>
    <style>
        .search-container {
            position: relative;
            margin-bottom: 20px;
            margin-left: 20px;
        }

        #searchInput {
            padding: 8px;
            width: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #353535;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
            z-index: 1;
            display: none;
        }

        #suggestions div {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }

        #suggestions div:hover {
            background-color: #f1f1f1;
        }

        .filter-links {
            margin-top: 10px;
        }

        .filter-links a {
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 5px;
        }

        .filter-links a:hover {
            background-color: #45a049;
        }

        .card-container {
            display: block;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            position: relative;
        }

        .options {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
        }

        .options-menu {
            display: none;
            position: absolute;
            top: 40px;
            right: 10px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 10;
        }

        .options-menu a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: black;
        }

        .options-menu a:hover {
            background-color: #f1f1f1;
        }

        .delete {
            color: red;
        }

        .image-container img {
            width: 100px;
            height: 100px;
            object-fit: cover;
        }

        .text-container {
            margin-left: 120px;
        }

        .pd {
            margin-top: 10px;
        }

        .category {
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search movies..." oninput="searchMovies()">
        <button onclick="searchMovies()">Search</button>
        <div class="filter-links">
            <a href="#" onclick="filterCategory('All')">All</a>
            <a href="#" onclick="filterCategory('movie')">Movies</a>
            <a href="#" onclick="filterCategory('webseries')">Web series</a>
            <a href="#" onclick="filterCategory('anime')">Anime</a>
        </div>
        <div id="suggestions"></div>
    </div>

    <button class="add-button" onclick="openModal()">Add</button>

    <%- include("./panel-movie-add.html") %>
    <%- include("./panel-movie-edit.html") %>
    <div id="cardsContainer"></div>

    <script>
        let activeOptionsMenu = null;
        let ttags = [];
        let selectedCategoryContentType = 'All';

        function searchMovies() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const cardContainer = document.getElementById("cardsContainer");
            const cards = cardContainer.getElementsByClassName("card-container");
            const suggestionsDiv = document.getElementById("suggestions");
            suggestionsDiv.innerHTML = "";
            let matchCount = 0;

            for (let i = 0; i < cards.length; i++) {
                const h4 = cards[i].querySelector(".text-container h4");
                const p = cards[i].querySelector(".text-container .pd");
                const contentCategory = cards[i].querySelector(".text-container #customText").textContent;
                const txtValue = h4.textContent || h4.innerText;
                const description = p.textContent || p.innerText;

                if ((txtValue.toUpperCase().indexOf(filter) > -1 || description.toUpperCase().indexOf(filter) > -1) &&
                    (selectedCategoryContentType === "All" || contentCategory.includes(selectedCategoryContentType))) {
                    cards[i].style.display = "";
                    if (filter && txtValue.toUpperCase().indexOf(filter) > -1) {
                        const suggestion = document.createElement("div");
                        suggestion.textContent = txtValue;
                        suggestion.onclick = function() {
                            input.value = this.textContent;
                            suggestionsDiv.innerHTML = "";
                            searchMovies();
                        };
                        suggestionsDiv.appendChild(suggestion);
                        matchCount++;
                    }
                } else {
                    cards[i].style.display = "none";
                }
            }

            suggestionsDiv.style.display = matchCount > 0 ? "block" : "none";
        }

        function filterCategory(category) {
            selectedCategoryContentType = category;
            searchMovies();
        }

        function truncateString(str, maxLength) {
            if (str.length > maxLength) {
                return str.substring(0, maxLength - 3) + '...';
            } else {
                return str;
            }
        }

        function addCard(data) {
            const { name, description, category_txt, img, id } = data;
            const cardContainer = document.createElement('div');
            cardContainer.classList.add('card-container');

            const optionsButton = document.createElement('div');
            optionsButton.classList.add('options');
            optionsButton.textContent = 'â€¦';
            optionsButton.onclick = function(event) {
                showOptionsMenu(event, cardContainer);
            };

            const optionsMenu = document.createElement('div');
            optionsMenu.classList.add('options-menu');
            optionsMenu.id = 'optionsMenu';

            const editLink = document.createElement('a');
            editLink.href = '#';
            editLink.textContent = 'Edit';
            editLink.onclick = function() {
                editMovie(name, this);
            };

            const deleteLink = document.createElement('a');
            deleteLink.href = '#';
            deleteLink.classList.add('delete');
            deleteLink.textContent = 'Delete';
            deleteLink.onclick = function() {
                confirmDeleteCard(name);
            };

            // Add Show/Hide Button
            const toggleVisibilityLink = document.createElement('a');
            toggleVisibilityLink.href = '#';
            toggleVisibilityLink.textContent = 'Show/Hide';
            toggleVisibilityLink.onclick = function() {
                toggleMovieVisibility(cardContainer);
            };

            optionsMenu.appendChild(editLink);
            optionsMenu.appendChild(deleteLink);
            optionsMenu.appendChild(toggleVisibilityLink); // Append Show/Hide button

            const imageContainer = document.createElement('div');
            imageContainer.classList.add('image-container');

            const imageElement = document.createElement('img');
            imageElement.src = img;
            imageElement.alt = 'Icon';

            imageContainer.appendChild(imageElement);

            const textContainer = document.createElement('div');
            textContainer.classList.add('text-container');

            const nameHeading = document.createElement('div');
            nameHeading.style.width = '100%';
            nameHeading.innerHTML = `<h4>${name}</h4>`;

            const descriptionParagraph = document.createElement('div');
            descriptionParagraph.classList.add('pd');
            descriptionParagraph.textContent = description;

            const category = document.createElement('div');
            category.classList.add('category');
            category.textContent = truncateString(category_txt.join(", "), 18);

            const customText = document.createElement('div');
            customText.id = 'customText';
            customText.style.position = 'absolute';
            customText.style.bottom = '5px';
            customText.style.left = '5px';
            customText.style.color = 'white';
            customText.textContent = id;

            textContainer.appendChild(nameHeading);
            textContainer.appendChild(descriptionParagraph);
            textContainer.appendChild(category);
            textContainer.appendChild(customText);

            cardContainer.appendChild(optionsButton);
            cardContainer.appendChild(optionsMenu);
            cardContainer.appendChild(imageContainer);
            cardContainer.appendChild(textContainer);

            const cardsContainer = document.getElementById('cardsContainer');
            cardsContainer.insertBefore(cardContainer, cardsContainer.childNodes[0]);
        }

        function toggleMovieVisibility(card) {
            if (card.style.display === 'none') {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        }

        function showOptionsMenu(event, cardContainer) {
            if (activeOptionsMenu) {
                activeOptionsMenu.style.display = 'none';
            }

            const optionsMenu = cardContainer.querySelector('.options-menu');
            optionsMenu.style.display = 'block';
            activeOptionsMenu = optionsMenu;

            document.addEventListener('click', function hideOptions(e) {
                if (!optionsMenu.contains(e.target) && !cardContainer.contains(e.target)) {
                    optionsMenu.style.display = 'none';
                    activeOptionsMenu = null;
                    document.removeEventListener('click', hideOptions);
                }
            });
        }

        function editMovie(name, link) {
            // Implement movie editing functionality
            alert('Edit movie: ' + name);
        }

        function confirmDeleteCard(name) {
            // Implement delete confirmation functionality
            if (confirm("Are you sure you want to delete " + name + "?")) {
                alert('Movie deleted: ' + name);
            }
        }

        function openModal() {
            // Open the modal to add a new movie
            alert('Open Add Movie Modal');
        }

    </script>
</body>
</html>
